!function(t){t.fn.easyGrid=function(e){function a(t){var e=t.data("easyGridConf"),a=parseInt(e.dataFlag,10),o=e.showHeader,s=e.showOperateCol,d=e.data,r='<div class="easy-grid">';if(0===a){var l=e.colKey,c={colKey:l,showOperateCol:s,operateCol:e.operateCol};if("false"===o.toString())r+=i(d,c);else{var f=e.header;r+=n(f,s,e.operateCol),r+=i(d,c)}}else console.log("源数据是二维数组");r+="</div>",t.html(r)}function n(t,e,a){if("undefined"==typeof t)return"";var n='<div class="easy-grid-header"><div class="easy-grid-row">';return t.forEach(function(t){n+='<div class="easy-grid-col col-default">'+t+"</div>"}),"true"===e.toString()&&(n+='<div class="easy-grid-col col-operate">'+a.header+"</div>"),n+="</div></div>"}function i(t,e){var a=e.colKey,n="undefined"!=typeof e.showOperateCol&&e.showOperateCol,i=e.operateCol,o="",s="",d="",r="";"undefined"!=typeof i&&("undefined"!=typeof i.update&&(o=i.update.text||""),"undefined"!=typeof i.del&&(s=i.del.text||""),"undefined"!=typeof i.save&&(d=i.save.text||""),"undefined"!=typeof i.cancel&&(r=i.cancel.text||""));var l='<div class="easy-grid-body">';return"undefined"==typeof a?console.log("源数据是二维数组"):t.forEach(function(t){l+='<div class="easy-grid-row">',a.forEach(function(e){l+='<div class="easy-grid-col col-default" data-key="'+e+'">'+t[e]+"</div>"}),"true"===n.toString()&&(l+='<div class="easy-grid-col col-operate"><button class="btn-operate btn-update">'+o+'</button><button class="btn-operate btn-del">'+s+'</button><button class="btn-operate btn-save">'+d+'</button><button class="btn-operate btn-cancel">'+r+'</button><button class="btn-operate btn-undo">'+r+"</button></div>"),l+="</div>"}),l+="</div>"}function o(e){var a=e.data("easyGridConf"),n=a.colWidth;"undefined"!=typeof n&&(t.isArray(n)&&e.find(".easy-grid-row").each(function(){t(this).children(".col-default").each(function(e){t(this).width(n[e])}).siblings(".col-operate").width(a.operateCol.width)}),e.find(".btn-save, .btn-cancel, .btn-undo").hide())}function s(e){var a=e.data("easyGridConf"),n=a.showOperateCol,i=a.showAddRow;if("true"===n.toString()){var o=a.operateCol.save.fn,s=a.operateCol.del.fn;c(e,a.primaryKey),h(e),f(e,s),u(e,o),"true"===i.toString()&&d(e,t(a.addRowSelector),a.addRowPosition)}}function d(e,a,n){a.on("click",function(){if(!t(this).hasClass("off")){t(this).addClass("off");var a=e.find(".easy-grid-body");r(e,a,n)}})}function r(e,a,n){var i;i="start"===n?a.children(".easy-grid-row:eq(0)").clone(!0):a.children(".easy-grid-row:last").clone(!0);var o,s,d=e.data("easyGridConf").addRowPrimaryKey,r=e.data("easyGridConf").addRowPrimaryKeyDefaultVal;i.hasClass("row-editable")?(i.find(".edit-status").val("").attr("placeholder","").end().find(".btn-cancel").hide().siblings(".btn-undo").show(),i.find(".col-default").each(function(){o=t(this),s=t.inArray(o.attr("data-key"),d),s===-1?o.children(".edit-status").removeAttr("disabled"):o.children(".edit-status").val(r[s])}),"start"===n?i.prependTo(a):a.append(i),i.find(".edit-status:eq(0)").focus(),l(e)):(i.addClass("row-editable").find(".col-default").each(function(){o=t(this),s=t.inArray(o.attr("data-key"),d),s===-1?o.html('<input type="text" class="edit-status" placeholder="">'):o.html('<input type="text" class="edit-status" disabled title="该项不可修改" placeholder="">').find(".edit-status").val(r[s])}).siblings(".col-operate").find(".btn-update, .btn-del, .btn-cancel").hide().siblings(".btn-save, .btn-undo").show(),"start"===n?i.prependTo(a):a.append(i),i.find(".edit-status:eq(0)").focus(),l(e))}function l(e){e.find(".btn-undo").on("click",function(){t(this).closest(".easy-grid-row").animate({height:0,opacity:0},300,function(){try{t(e.data("easyGridConf").addRowSelector).removeClass("off")}catch(t){console.warn(t)}t(this).remove()})})}function c(e,a){var n,i,o;e.find(".btn-update").on("click",function(){o=t(this),o.hide().siblings(".btn-del").hide().siblings(".btn-save, .btn-cancel").show().closest(".col-operate").siblings(".col-default").each(function(){n=t(this),i=n.text(),t.inArray(n.attr("data-key"),a)>-1?n.html('<input type="text" class="edit-status" disabled title="该项不可修改" placeholder="'+i+'">').children(".edit-status").val(i):n.html('<input type="text" class="edit-status can-update" placeholder="'+i+'">').children(".edit-status").val(i)}),o.closest(".easy-grid-row").addClass("row-editable").find(".edit-status.can-update:eq(0)").focus().select()})}function f(e,a){e.find(".btn-del").on("click",function(){if("function"==typeof a){var e=t(this).closest(".easy-grid-row"),n=y(e),i=a(n);i?t(this).closest(".easy-grid-row").animate({height:0,opacity:0},300,"swing",function(){t(this).remove()}):console.warn("删除失败")}})}function u(e,a){var n;e.find(".btn-save").on("click",function(){if("function"==typeof a){var i=t(this).closest(".easy-grid-row"),o=y(i),s=a(o);if(s){var d;n=t(this),n.closest(".easy-grid-row").find(".edit-status").each(function(){d=this.value,t(this).parent().html(d)}),n.hide().siblings(".btn-cancel, .btn-undo").hide().siblings(".btn-update, .btn-del").show().closest(".easy-grid-row").removeClass("row-editable");try{t(e.data("easyGridConf").addRowSelector).removeClass("off")}catch(t){console.warn(t)}}else console.warn("保存失败")}})}function h(e){var a;e.find(".btn-cancel").on("click",function(){var e;a=t(this),a.closest(".easy-grid-row").find(".edit-status").each(function(){e=this.getAttribute("placeholder"),t(this).parent().html(e)}),a.hide().siblings(".btn-save").hide().siblings(".btn-update, .btn-del").show().closest(".easy-grid-row").removeClass("row-editable")})}function y(e){var a,n={};return e.hasClass("row-editable")?e.find("[data-key]").each(function(){a=t(this),n[a.attr("data-key")]=a.children(".edit-status").val()}):e.find("[data-key]").each(function(){a=t(this),n[a.attr("data-key")]=a.text()}),n}function p(e){var a=e.data;return t.isArray(a)?"undefined"!=typeof a[0]||(console.error('"data"参数必须是对象数组或二维数组!'),!1):(console.error('"data"参数必须是数组!'),!1)}var b={dataFlag:0,showHeader:!1,showAddRow:!1,showOperateCol:!1,addRowPosition:"end",addRowPrimaryKey:[],addRowPrimaryKeyDefaultVal:[],primaryKey:[],showPager:!1,pagerSize:10},v=t.extend(b,e);return this.each(function(e){var n=p(v);if(n){var i=t(this);i.data("easyGridConf",v),a(i),o(i),s(i)}})}}(jQuery);