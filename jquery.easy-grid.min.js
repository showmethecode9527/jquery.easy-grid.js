!function(e){"use strict";e.fn.easyGrid=function(t){function a(e){var t=e.data("easyGridConf"),a=parseInt(t.dataFlag,10),s=t.showHeader,n=t.showOperateCol,d=t.showSelectCol,r=t.data,l='<div class="easy-grid">';if(0===a){var c=t.colKey,f={colKey:c,showSelectCol:d,showOperateCol:n,operateCol:t.operateCol};if("false"===s.toString())l+=i(r,f);else{var u=t.header;l+=o(u,d,n,t.operateCol),l+=i(r,f)}}else console.log("源数据是二维数组");l+="</div>",e.html(l)}function o(e,t,a,o){if("undefined"==typeof e)return"";var i='<div class="easy-grid-header"><div class="easy-grid-row">';return"true"===t.toString()&&(i+='<div class="easy-grid-col col-select"><input type="checkbox" class="select-row select-row-all"></div>'),e.forEach(function(e){i+='<div class="easy-grid-col col-default">'+e+"</div>"}),"true"===a.toString()&&(i+='<div class="easy-grid-col col-operate">'+o.header+"</div>"),i+="</div></div>"}function i(e,t){var a=t.colKey,o=t.showOperateCol,i=t.showSelectCol,s=t.operateCol,n="",d="",r="",l="";"undefined"!=typeof s&&("undefined"!=typeof s.update&&(n=s.update.text||""),"undefined"!=typeof s.del&&(d=s.del.text||""),"undefined"!=typeof s.save&&(r=s.save.text||""),"undefined"!=typeof s.cancel&&(l=s.cancel.text||""));var c='<div class="easy-grid-body">';return"undefined"==typeof a?console.log("源数据是二维数组"):e.forEach(function(e){c+='<div class="easy-grid-row">',"true"===i.toString()&&(c+='<div class="easy-grid-col col-select"><input type="checkbox" class="select-row"></div>'),a.forEach(function(t){c+='<div class="easy-grid-col col-default" data-key="'+t+'">'+e[t]+"</div>"}),"true"===o.toString()&&(c+='<div class="easy-grid-col col-operate"><button class="btn btn-operate btn-update">'+n+'</button><button class="btn btn-operate btn-del">'+d+'</button><button class="btn btn-operate btn-save">'+r+'</button><button class="btn btn-operate btn-cancel">'+l+'</button><button class="btn btn-operate btn-undo">'+l+"</button></div>"),c+="</div>"}),c+="</div>"}function s(t){var a=t.data("easyGridConf"),o=a.showSelectCol.toString(),i=a.showOperateCol.toString(),s=a.colWidth;if("undefined"!=typeof s){if(e.isArray(s)){var n=0,d=a.selectColWidth;try{n=a.operateCol.width}catch(e){console.log(e)}var r;t.find(".easy-grid-row").each(function(){r=e(this),r.children(".col-default").each(function(t){0===parseInt(s[t],10)&&e(this).addClass("hide"),this.style.width=s[t]}),"true"===o&&(r.children(".col-select")[0].style.width=d),"true"===i&&(r.children(".col-operate")[0].style.width=n)})}t.find(".btn-save, .btn-cancel, .btn-undo").hide()}}function n(t){var a=t.data("easyGridConf"),o=a.showOperateCol,i=a.showSelectCol,s=a.delRowsSelector,n=a.showAddRow;if("true"===o.toString()){var r=a.operateCol.save.fn,l=a.operateCol.del.fn;c(t,a.primaryKey),h(t),f(t,l),u(t,r),"true"===n.toString()&&d(t,e(a.addRowSelector),a.addRowPosition)}if("true"===i.toString()){y(t);var b=e(s);0!==b.length&&p(t,b)}}function d(t,a,o){a.on("click",function(){if(!e(this).hasClass("off")){e(this).addClass("off");var a=t.find(".easy-grid-body");r(t,a,o)}})}function r(t,a,o){var i;i="start"===o?a.children(".easy-grid-row:eq(0)").clone(!0):a.children(".easy-grid-row:last").clone(!0);var s,n,d=t.data("easyGridConf").addRowPrimaryKey,r=t.data("easyGridConf").addRowPrimaryKeyDefaultVal;i.hasClass("row-editable")?(i.find(".edit-status").val("").attr("placeholder","").end().find(".btn-cancel").hide().siblings(".btn-undo").show(),i.find(".col-default").each(function(){s=e(this),n=e.inArray(s.attr("data-key"),d),n===-1?s.children(".edit-status").removeAttr("disabled"):s.children(".edit-status").val(r[n])}),"start"===o?i.prependTo(a):a.append(i),i.find(".edit-status:eq(0)").focus(),l(t)):(i.addClass("row-editable").find(".col-default").each(function(){s=e(this),n=e.inArray(s.attr("data-key"),d),n===-1?s.html('<input type="text" class="edit-status" placeholder="">'):s.html('<input type="text" class="edit-status" disabled title="该项不可修改" placeholder="">').find(".edit-status").val(r[n])}).siblings(".col-operate").find(".btn-update, .btn-del, .btn-cancel").hide().siblings(".btn-save, .btn-undo").show(),"start"===o?i.prependTo(a):a.append(i),i.find(".edit-status:eq(0)").focus(),l(t))}function l(t){t.find(".btn-undo").on("click",function(){e(this).closest(".easy-grid-row").animate({height:0,opacity:0},300,function(){try{e(t.data("easyGridConf").addRowSelector).removeClass("off")}catch(e){console.warn(e)}e(this).remove()})})}function c(t,a){var o,i,s;t.find(".btn-update").on("click",function(){s=e(this),s.hide().siblings(".btn-del").hide().siblings(".btn-save, .btn-cancel").show().closest(".col-operate").siblings(".col-default").each(function(){o=e(this),i=o.text(),e.inArray(o.attr("data-key"),a)>-1?o.html('<input type="text" class="edit-status" disabled title="该项不可修改" placeholder="'+i+'">').children(".edit-status").val(i):o.html('<input type="text" class="edit-status can-update" placeholder="'+i+'">').children(".edit-status").val(i)}),s.closest(".easy-grid-row").addClass("row-editable").find(".edit-status.can-update:eq(0)").focus().select()})}function f(t,a){t.find(".btn-del").on("click",function(){if("function"==typeof a){var t=e(this).closest(".easy-grid-row"),o=b(t),i=a(o);i?e(this).closest(".easy-grid-row").animate({height:0,opacity:0},300,"swing",function(){e(this).remove()}):console.warn("删除失败")}})}function u(t,a){var o;t.find(".btn-save").on("click",function(){if("function"==typeof a){var i=e(this).closest(".easy-grid-row"),s=b(i),n=a(s);if(n){var d;o=e(this),o.closest(".easy-grid-row").find(".edit-status").each(function(){d=this.value,e(this).parent().html(d)}),o.hide().siblings(".btn-cancel, .btn-undo").hide().siblings(".btn-update, .btn-del").show().closest(".easy-grid-row").removeClass("row-editable");try{e(t.data("easyGridConf").addRowSelector).removeClass("off")}catch(e){console.warn(e)}}else console.warn("保存失败")}})}function h(t){var a;t.find(".btn-cancel").on("click",function(){var t;a=e(this),a.closest(".easy-grid-row").find(".edit-status").each(function(){t=this.getAttribute("placeholder"),e(this).parent().html(t)}),a.hide().siblings(".btn-save").hide().siblings(".btn-update, .btn-del").show().closest(".easy-grid-row").removeClass("row-editable")})}function y(t){t.find(".easy-grid-body .select-row").on("click",function(){e(this).closest(".easy-grid-row").toggleClass("selected")}),t.find(".easy-grid-header .select-row").on("click",function(){var a=e(this),o=a.closest(".easy-grid-row");o.hasClass("selected")?(t.find(".easy-grid-body .select-row:checked").trigger("click"),o.removeClass("selected")):(t.find(".easy-grid-body .select-row:not(:checked)").trigger("click"),o.addClass("selected"))})}function p(t,a){a.on("click",function(){var a=[],o=t.data("easyGridConf").delRowsFn;t.find(".easy-grid-body .easy-grid-row.selected").each(function(){a.push(b(e(this)))}),"function"==typeof o&&o(a)})}function b(t){var a,o={};return t.hasClass("row-editable")?t.find("[data-key]").each(function(){a=e(this),o[a.attr("data-key")]=a.children(".edit-status").val()}):t.find("[data-key]").each(function(){a=e(this),o[a.attr("data-key")]=a.text()}),o}function w(t){var a=t.data;return e.isArray(a)?"undefined"!=typeof a[0]||(console.error('"data"参数必须是对象数组或二维数组!'),!1):(console.error('"data"参数必须是数组!'),!1)}var v={dataFlag:0,showHeader:!1,showSelectCol:!1,selectColWidth:"0",showAddRow:!1,showOperateCol:!1,addRowPosition:"end",delRowsSelector:"",delRowsFn:"",addRowPrimaryKey:[],addRowPrimaryKeyDefaultVal:[],primaryKey:[],showPager:!1,pagerSize:10},g=e.extend(v,t);return this.each(function(){var t=w(g);if(t){var o=e(this);o.data("easyGridConf",g),a(o),s(o),n(o)}})}}(jQuery);